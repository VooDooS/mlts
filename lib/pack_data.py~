#!/usr/bin/env python
# # -*- coding: utf-8 -*-

import os
import base64

output = "type file = { name: string; text: string }"
output += "\nlet files = ["

directory = os.fsencode("core/")
first = True

for file in os.listdir(directory):
    filename = os.fsdecode(file)
    if filename.endswith(".mod") or filename.endswith(".sig") or filename.endswith(".elpi"):
        if not first: output += "; "
        output += "{ name = \""
        output += filename
        output += "\"; text = \""
        
        with open(os.path.join(directory, file), 'r') as content_file:
            content = os.fsdecode(content_file.read())
        output += (base64.b64encode(content.encode())).decode()
        output += "\" }"
        first = False
    else:
        continue

output += "]"
output += "\n let load () = List.iter (fun f -> Sys_js.create_file f.name (B64.decode f.text)) files"
print(output)
